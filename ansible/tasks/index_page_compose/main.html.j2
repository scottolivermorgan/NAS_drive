<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Service Links</title>
    <link rel="icon" href="icons/pi_server2.ico" type="image/x-icon">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f9;
            margin: 0;
            padding: 0;
        }

        header {
            background-color: #333;
            color: white;
            padding: 0 20px; /* Adjusted padding to give space on the sides */
            height: 100px; /* Set a height to allow vertical centering */
            display: flex;
            align-items: center; /* Vertically center the content */
            justify-content: center; /* Center the content horizontally */
        }

        header img {
            width: 80px;
            height: 80px;
            margin-right: 10px;
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* 3 columns */
            gap: 20px;
            padding: 20px;
        }

        .card {
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            text-align: center;
            padding: 20px;
            position: relative; /* Position relative to place the badge */
            transition: transform 0.3s;
        }

        .card:hover {
            transform: translateY(-10px);
        }

        .card a {
            text-decoration: none;
            color: #333;
            font-size: 18px;
            font-weight: bold;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .card a img {
            width: 40px;
            height: 40px;
            margin-bottom: 10px;
        }

        .card a:hover {
            color: #007bff;
        }

        /* Notification Badge */
        .notification-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 20px;
            height: 20px;
            background-color: red;
            color: white;
            border-radius: 50%;
            font-size: 12px;
            display: none; /* Initially hidden */
            align-items: center;
            justify-content: center;
            display: flex;
            text-align: center;
            padding: 2px;
        }
    </style>
</head>
<body>

<header>
    <img src="icons/pi_server2.ico" alt="Server Icon">
    Service Links
</header>

<div class="grid-container">
    <div class="card">
        <a href="http://{{ server_ip }}:{{ ports.audiobookshelf }}" target="_blank">
            <img src="icons/abs.png" alt="Audiobookshelf">
            Audiobookshelf
        </a>
    </div>
    <div class="card">
        <a href="http://{{ server_ip }}:{{ ports.bazarr }}" target="_blank">
            <img src="icons/bazarr.svg" alt="Bazarr">
            Bazarr
        </a>
    </div>
    <div class="card">
        <a href="http://{{ server_ip }}:{{ ports.grafana }}" target="_blank">
            <img src="icons/grafana.svg" alt="Grafana">
            Grafana
        </a>
    </div>
    <div class="card">
        <a href="http://{{ server_ip }}:{{ ports.immich }}" target="_blank">
            <img src="icons/immich.svg" alt="Immich">
            Immich
        </a>
    </div>
    <div class="card">
        <a href="http://{{ server_ip }}:{{ ports.influxdb }}" target="_blank">
            <img src="icons/influxdb.svg" alt="InfluxDB">
            InfluxDB
        </a>
    </div>
    <div class="card">
        <a href="http://{{ server_ip }}:{{ ports.jellyfin }}" target="_blank">
            <img src="icons/jellyfin.svg" alt="Jellyfin">
            Jellyfin
        </a>
    </div>
    <div class="card">
        <a href="http://{{ server_ip }}:{{ ports.komga }}" target="_blank">
            <img src="icons/komga.svg" alt="Komga">
            Komga
        </a>
    </div>
    <div class="card">
        <a href="http://{{ server_ip }}:{{ ports.nextcloud }}" target="_blank">
            <img src="icons/nextcloud.svg" alt="Nextcloud">
            Nextcloud
        </a>
    </div>
    <div class="card">
        <a href="http://{{ server_ip }}:{{ ports.prowlarr }}/" target="_blank">
            <img src="icons/prowlarr.svg" alt="Prowlarr">
            Prowlarr
        </a>
    </div>
    <div class="card">
        <a href="http://{{ server_ip }}:{{ ports.qbittorrent_web }}" target="_blank">
            <img src="icons/qbittorrent.svg" alt="qbittorrent">
            qbittorrent
        </a>
    </div>
    <div class="card">
        <a href="http://{{ server_ip }}:{{ ports.radarr }}" target="_blank">
            <img src="icons/radarr.svg" alt="Radarr">
            Radarr
        </a>
    </div>
    <div class="card">
        <a href="http://{{ server_ip }}:{{ ports.sonarr }}" target="_blank">
            <img src="icons/sonarr.svg" alt="Sonarr">
            Sonarr
        </a>
    </div>
    <div class="card">
        <a href="http://{{ server_ip }}:{{ ports.tandoor }}" target="_blank">
            <img src="icons/tandoor.svg" alt="Tandoor">
            Tandoor
        </a>
    </div>
    <div class="card" id="ntfy-card">
        <a href="http://{{ server_ip }}:{{ ports.ntfy }}" target="_blank">
            <img src="icons/ntfy.svg" alt="NTFY">
            NTFY
            <span class="notification-badge" id="ntfy-badge">0</span>
        </a>
    </div>
    <div class="card">
        <a href="http://{{ server_ip }}:{{ ports.vaultwarden }}" target="_blank">
            <img src="icons/vaultwarden.png" alt="vaultwarden">
            VaultWarden
        </a>
    </div>
    <div class="card">
        <a href="http://{{ server_ip }}:{{ ports.romm }}" target="_blank">
            <img src="icons/romm.png" alt="romm">
            Romm
        </a>
    </div>
    
</div>

<script>
    const socket = new WebSocket('ws://{{ server_ip }}:{{ ports.ntfy }}/ws/test');
    let notificationCount = 0;

    // Function to update the notification badge
    function updateNotificationBadge(count) {
        const badge = document.getElementById('ntfy-badge');
        if (count > 0) {
            badge.style.display = 'flex'; // Show the badge
            badge.innerText = count; // Set the notification count
        } else {
            badge.style.display = 'none'; // Hide the badge if no notifications
        }
    }

    // WebSocket onmessage event handler to listen for notifications
    socket.onmessage = (event) => {
        // You can modify this to display the actual notification content if needed
        notificationCount++;
        updateNotificationBadge(notificationCount);
    };

    // Optional: If you want to clear the count after clicking the card, add this event listener
    document.getElementById('ntfy-card').addEventListener('click', () => {
        notificationCount = 0;
        updateNotificationBadge(notificationCount);
    });
</script>

</body>
</html>
